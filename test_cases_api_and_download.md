# API测试功能和下载任务功能测试用例文档

## 文档信息
- 作者: cjx
- 邮箱: xx4125517@126.com
- 时间: 2025-12-20 15:40:00
- 版本: v1.0

## 1. 测试目的
验证DdOaListDownload后端系统API测试功能和下载任务功能的正确性、完整性和可靠性，确保系统能够按照设计要求进行API测试和下载任务管理。

## 2. 测试范围
1. API测试功能测试
   - 测试用例管理
   - 测试执行
   - 测试历史记录管理
2. 下载任务功能测试
   - 任务创建和管理
   - 异步执行
   - 结果查询

## 3. 测试环境
- 操作系统: Windows
- 后端服务: Go 1.20+
- 数据库: MySQL 8.0+, Redis 7.0+
- 测试工具: Postman

## 4. 测试用例

### 4.1 API测试功能测试

#### 4.1.1 测试场景：测试用例管理

##### 4.1.1.1 创建测试用例
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API001 | 创建测试用例 | 1. 登录系统，获取管理员令牌<br>2. 调用 `/api/v1/api-test/case` 接口创建一个新的测试用例<br>3. 调用 `/api/v1/api-test/case/:id` 接口验证测试用例创建成功 | 1. 登录成功，返回管理员令牌<br>2. 测试用例创建成功<br>3. 返回创建的测试用例信息，与输入一致 | | |

##### 4.1.1.2 查询测试用例
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API002 | 查询测试用例 | 1. 登录系统，获取管理员令牌<br>2. 创建多个测试用例<br>3. 调用 `/api/v1/api-test/case` 接口查询所有测试用例<br>4. 验证返回结果包含所有创建的测试用例<br>5. 调用 `/api/v1/api-test/case/:id` 接口查询单个测试用例<br>6. 验证返回结果与该测试用例信息一致 | 1. 登录成功，返回管理员令牌<br>2. 多个测试用例创建成功<br>3. 查询接口调用成功<br>4. 返回结果包含所有创建的测试用例<br>5. 查询接口调用成功<br>6. 返回结果与该测试用例信息一致 | | |

##### 4.1.1.3 更新测试用例
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API003 | 更新测试用例 | 1. 登录系统，获取管理员令牌<br>2. 创建一个测试用例<br>3. 调用 `/api/v1/api-test/case/:id` 接口获取测试用例详情<br>4. 调用 `/api/v1/api-test/case/:id` 接口更新测试用例的某些字段<br>5. 再次调用查询接口，验证测试用例已更新 | 1. 登录成功，返回管理员令牌<br>2. 测试用例创建成功<br>3. 返回测试用例详情<br>4. 测试用例更新成功<br>5. 返回更新后的测试用例信息，与更新请求一致 | | |

##### 4.1.1.4 删除测试用例
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API004 | 删除测试用例 | 1. 登录系统，获取管理员令牌<br>2. 创建一个测试用例<br>3. 调用 `/api/v1/api-test/case/:id` 接口删除该测试用例<br>4. 调用 `/api/v1/api-test/case/:id` 接口查询该测试用例<br>5. 验证返回结果显示该测试用例不存在 | 1. 登录成功，返回管理员令牌<br>2. 测试用例创建成功<br>3. 测试用例删除成功<br>4. 查询接口调用失败<br>5. 返回错误信息，提示该测试用例不存在 | | |

#### 4.1.2 测试场景：测试执行

##### 4.1.2.1 执行单个测试用例
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API005 | 执行单个测试用例 | 1. 登录系统，获取管理员令牌<br>2. 创建一个有效的测试用例<br>3. 调用 `/api/v1/api-test/case/:id/run` 接口执行该测试用例<br>4. 验证测试执行成功，并返回执行结果<br>5. 查询测试历史记录，验证执行结果已被记录 | 1. 登录成功，返回管理员令牌<br>2. 测试用例创建成功<br>3. 测试执行成功，返回执行结果<br>4. 执行结果符合预期<br>5. 测试历史记录中包含该次执行记录 | | |

##### 4.1.2.2 执行不存在的测试用例
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API006 | 执行不存在的测试用例 | 1. 登录系统，获取管理员令牌<br>2. 调用 `/api/v1/api-test/case/9999/run` 接口执行不存在的测试用例<br>3. 验证接口返回错误信息 | 1. 登录成功，返回管理员令牌<br>2. 接口调用失败<br>3. 返回错误信息，提示测试用例不存在 | | |

#### 4.1.3 测试场景：测试历史记录管理

##### 4.1.3.1 查询测试历史记录
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API007 | 查询测试历史记录 | 1. 登录系统，获取管理员令牌<br>2. 创建一个测试用例<br>3. 执行该测试用例多次<br>4. 调用 `/api/v1/api-test/history` 接口查询测试历史记录<br>5. 验证返回结果包含所有执行记录<br>6. 调用 `/api/v1/api-test/history/:id` 接口查询单个执行记录<br>7. 验证返回结果与该执行记录信息一致 | 1. 登录成功，返回管理员令牌<br>2. 测试用例创建成功<br>3. 测试用例执行成功多次<br>4. 查询接口调用成功<br>5. 返回结果包含所有执行记录<br>6. 查询接口调用成功<br>7. 返回结果与该执行记录信息一致 | | |

##### 4.1.3.2 删除测试历史记录
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API008 | 删除测试历史记录 | 1. 登录系统，获取管理员令牌<br>2. 创建一个测试用例<br>3. 执行该测试用例<br>4. 查询测试历史记录，获取记录ID<br>5. 调用 `/api/v1/api-test/history/:id` 接口删除该执行记录<br>6. 再次查询测试历史记录，验证该记录已被删除 | 1. 登录成功，返回管理员令牌<br>2. 测试用例创建成功<br>3. 测试用例执行成功<br>4. 查询到执行记录，获取记录ID<br>5. 执行记录删除成功<br>6. 测试历史记录中不包含该条记录 | | |

##### 4.1.3.3 清空测试历史记录
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| API009 | 清空测试历史记录 | 1. 登录系统，获取管理员令牌<br>2. 创建多个测试用例<br>3. 执行这些测试用例多次<br>4. 调用 `/api/v1/api-test/history/clear` 接口清空测试历史记录<br>5. 查询测试历史记录，验证所有记录已被清空 | 1. 登录成功，返回管理员令牌<br>2. 多个测试用例创建成功<br>3. 测试用例执行成功多次<br>4. 清空操作成功<br>5. 测试历史记录为空 | | |

### 4.2 下载任务功能测试

#### 4.2.1 测试场景：任务创建和管理

##### 4.2.1.1 创建下载任务
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT001 | 创建下载任务 | 1. 登录系统，获取用户令牌<br>2. 调用 `/api/v1/download-task` 接口创建一个下载任务<br>3. 验证任务创建成功，并返回任务ID<br>4. 调用 `/api/v1/download-task/:id` 接口查询该任务<br>5. 验证返回结果与任务创建信息一致 | 1. 登录成功，返回用户令牌<br>2. 任务创建成功，返回任务ID<br>3. 任务状态为待执行<br>4. 查询接口调用成功<br>5. 返回结果与任务创建信息一致 | | |

##### 4.2.1.2 查询用户的下载任务
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT002 | 查询用户的下载任务 | 1. 登录系统，获取用户令牌<br>2. 创建多个下载任务<br>3. 调用 `/api/v1/download-task/user/:user_id` 接口查询该用户的所有下载任务<br>4. 验证返回结果包含所有创建的下载任务 | 1. 登录成功，返回用户令牌<br>2. 多个下载任务创建成功<br>3. 查询接口调用成功<br>4. 返回结果包含所有创建的下载任务 | | |

##### 4.2.1.3 查询所有下载任务（管理员）
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT003 | 查询所有下载任务（管理员） | 1. 登录系统，获取管理员令牌<br>2. 创建多个下载任务，使用不同用户身份<br>3. 调用 `/api/v1/download-task` 接口查询所有下载任务<br>4. 验证返回结果包含所有创建的下载任务 | 1. 登录成功，返回管理员令牌<br>2. 多个下载任务创建成功<br>3. 查询接口调用成功<br>4. 返回结果包含所有创建的下载任务 | | |

##### 4.2.1.4 删除下载任务
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT004 | 删除下载任务 | 1. 登录系统，获取用户令牌<br>2. 创建一个下载任务<br>3. 调用 `/api/v1/download-task/:id` 接口删除该任务<br>4. 查询该任务，验证任务已被删除 | 1. 登录成功，返回用户令牌<br>2. 任务创建成功<br>3. 任务删除成功<br>4. 查询结果显示任务不存在 | | |

#### 4.2.2 测试场景：异步执行

##### 4.2.2.1 验证任务异步执行
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT005 | 验证任务异步执行 | 1. 登录系统，获取用户令牌<br>2. 调用 `/api/v1/download-task` 接口创建一个下载任务<br>3. 立即查询任务状态，验证状态为执行中<br>4. 等待一段时间后，再次查询任务状态<br>5. 验证任务状态变为已完成 | 1. 登录成功，返回用户令牌<br>2. 任务创建成功<br>3. 任务状态为执行中<br>4. 任务状态变为已完成<br>5. 异步执行机制正常工作 | | |

##### 4.2.2.2 同时创建多个下载任务
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT006 | 同时创建多个下载任务 | 1. 登录系统，获取用户令牌<br>2. 同时创建多个下载任务（如5个）<br>3. 验证所有任务创建成功<br>4. 查询任务状态，验证所有任务都在执行或已完成<br>5. 验证系统能够正常处理多个并发任务 | 1. 登录成功，返回用户令牌<br>2. 所有任务创建成功<br>3. 任务状态为执行中或已完成<br>4. 系统能够正常处理多个并发任务，无崩溃或错误 | | |

#### 4.2.3 测试场景：结果查询

##### 4.2.3.1 查询已完成任务的结果
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT007 | 查询已完成任务的结果 | 1. 登录系统，获取用户令牌<br>2. 创建一个下载任务<br>3. 等待任务完成<br>4. 调用 `/api/v1/download-task/result/:task_id` 接口查询任务结果<br>5. 验证返回结果包含下载链接或数据<br>6. 验证结果格式符合预期 | 1. 登录成功，返回用户令牌<br>2. 任务创建成功<br>3. 任务状态变为已完成<br>4. 查询接口调用成功<br>5. 返回结果包含下载链接或数据<br>6. 结果格式符合预期 | | |

##### 4.2.3.2 查询未完成任务的结果
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT008 | 查询未完成任务的结果 | 1. 登录系统，获取用户令牌<br>2. 创建一个下载任务<br>3. 立即调用 `/api/v1/download-task/result/:task_id` 接口查询任务结果<br>4. 验证接口返回错误信息或提示任务未完成 | 1. 登录成功，返回用户令牌<br>2. 任务创建成功<br>3. 接口调用失败或返回特殊状态<br>4. 返回错误信息或提示任务未完成，结果不可用 | | |

##### 4.2.3.3 查询不存在任务的结果
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| DT009 | 查询不存在任务的结果 | 1. 登录系统，获取用户令牌<br>2. 调用 `/api/v1/download-task/result/9999` 接口查询不存在任务的结果<br>3. 验证接口返回错误信息 | 1. 登录成功，返回用户令牌<br>2. 接口调用失败<br>3. 返回错误信息，提示任务不存在 | | |

## 5. 测试执行记录
| 测试用例ID | 执行日期 | 执行人员 | 执行结果 | 问题描述 | 严重程度 |
|------------|----------|----------|----------|----------|----------|
| API001 | 2025-12-20 | cjx | 通过 | 创建测试用例功能正常 | - |
| API002 | 2025-12-20 | cjx | 通过 | 查询测试用例功能正常 | - |
| API003 | 2025-12-20 | cjx | 待执行 | 更新测试用例 | - |
| API004 | 2025-12-20 | cjx | 待执行 | 删除测试用例 | - |
| API005 | 2025-12-20 | cjx | 待执行 | 执行单个测试用例 | - |
| API006 | 2025-12-20 | cjx | 待执行 | 执行不存在的测试用例 | - |
| API007 | 2025-12-20 | cjx | 待执行 | 查询测试历史记录 | - |
| API008 | 2025-12-20 | cjx | 待执行 | 删除测试历史记录 | - |
| API009 | 2025-12-20 | cjx | 待执行 | 清空测试历史记录 | - |
| DT001 | 2025-12-20 | cjx | 通过 | 创建下载任务功能正常 | - |
| DT002 | 2025-12-20 | cjx | 通过 | 查询用户的下载任务功能正常 | - |
| DT003 | 2025-12-20 | cjx | 待执行 | 查询所有下载任务（管理员） | - |
| DT004 | 2025-12-20 | cjx | 待执行 | 删除下载任务 | - |
| DT005 | 2025-12-20 | cjx | 待执行 | 验证任务异步执行 | - |
| DT006 | 2025-12-20 | cjx | 待执行 | 同时创建多个下载任务 | - |
| DT007 | 2025-12-20 | cjx | 待执行 | 查询已完成任务的结果 | - |
| DT008 | 2025-12-20 | cjx | 待执行 | 查询未完成任务的结果 | - |
| DT009 | 2025-12-20 | cjx | 待执行 | 查询不存在任务的结果 | - |

## 6. 测试结论
| 测试功能 | 测试结果 | 备注 |
|----------|----------|------|
| 测试用例管理 | 部分通过 | 已完成创建和查询功能测试 |
| 测试执行 | 待执行 | |
| 测试历史记录管理 | 待执行 | |
| 任务创建和管理 | 部分通过 | 已完成创建和查询用户下载任务功能测试 |
| 异步执行 | 待执行 | |
| 结果查询 | 待执行 | |

## 7. 问题列表
| 问题ID | 问题描述 | 严重程度 | 复现步骤 | 解决方案 |
|--------|----------|----------|----------|----------|
| | | | | |
| | | | | |
| | | | | |

## 8. 建议
1. 
2. 
3. 
