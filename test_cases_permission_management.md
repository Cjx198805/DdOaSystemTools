# 权限管理功能测试用例文档

## 文档信息
- 作者: cjx
- 邮箱: xx4125517@126.com
- 时间: 2025-12-20 15:30:00
- 版本: v1.0

## 1. 测试目的
验证DdOaListDownload后端系统权限管理功能的正确性、完整性和可靠性，确保系统能够按照设计要求进行权限控制。

## 2. 测试范围
1. 单用户多角色分配功能
2. 字段级权限控制
3. 数据字典功能
4. 特殊权限优先级验证

## 3. 测试环境
- 操作系统: Windows
- 后端服务: Go 1.20+
- 数据库: MySQL 8.0+, Redis 7.0+
- 测试工具: Postman

## 4. 测试用例

### 4.1 单用户多角色分配功能

#### 4.1.1 测试场景：为用户分配单个角色
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P001 | 为用户分配单个角色 | 1. 登录系统，获取管理员令牌<br>2. 创建一个新角色<br>3. 创建一个新用户<br>4. 调用 `/api/v1/user/:id/assign-roles` 接口为用户分配角色<br>5. 调用 `/api/v1/user/:id/roles` 接口验证角色分配 | 1. 登录成功，返回管理员令牌<br>2. 角色创建成功<br>3. 用户创建成功<br>4. 角色分配成功<br>5. 返回用户已分配的角色信息，包含刚分配的角色 | | |

#### 4.1.2 测试场景：为用户分配多个角色
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P002 | 为用户分配多个角色 | 1. 登录系统，获取管理员令牌<br>2. 创建两个新角色（角色A和角色B）<br>3. 创建一个新用户<br>4. 调用 `/api/v1/user/:id/assign-roles` 接口为用户同时分配角色A和角色B<br>5. 调用 `/api/v1/user/:id/roles` 接口验证角色分配 | 1. 登录成功，返回管理员令牌<br>2. 两个角色创建成功<br>3. 用户创建成功<br>4. 角色分配成功<br>5. 返回用户已分配的角色信息，包含角色A和角色B | | |

#### 4.1.3 测试场景：修改用户已分配的角色
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P003 | 修改用户已分配的角色 | 1. 登录系统，获取管理员令牌<br>2. 创建两个新角色（角色A和角色B）<br>3. 创建一个新用户<br>4. 调用 `/api/v1/user/:id/assign-roles` 接口为用户分配角色A<br>5. 验证用户已分配角色A<br>6. 调用 `/api/v1/user/:id/assign-roles` 接口将用户角色修改为角色B<br>7. 验证用户已分配角色B，不再有角色A | 1. 登录成功，返回管理员令牌<br>2. 两个角色创建成功<br>3. 用户创建成功<br>4. 角色分配成功<br>5. 用户已分配角色A<br>6. 角色修改成功<br>7. 用户已分配角色B，不再有角色A | | |

#### 4.1.4 测试场景：移除用户的所有角色
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P004 | 移除用户的所有角色 | 1. 登录系统，获取管理员令牌<br>2. 创建一个新角色<br>3. 创建一个新用户<br>4. 调用 `/api/v1/user/:id/assign-roles` 接口为用户分配角色<br>5. 验证用户已分配角色<br>6. 调用 `/api/v1/user/:id/assign-roles` 接口，传入空角色列表<br>7. 验证用户没有分配任何角色 | 1. 登录成功，返回管理员令牌<br>2. 角色创建成功<br>3. 用户创建成功<br>4. 角色分配成功<br>5. 用户已分配角色<br>6. 角色移除成功<br>7. 用户没有分配任何角色 | | |

### 4.2 字段级权限控制

#### 4.2.1 测试场景：设置字段查看权限
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P005 | 设置字段查看权限 | 1. 登录系统，获取管理员令牌<br>2. 创建一个新角色<br>3. 调用 `/api/v1/field-permission` 接口为该角色设置某模块字段的查看权限为不可见<br>4. 创建一个属于该角色的用户<br>5. 以该用户身份登录，调用相关模块的查询接口<br>6. 验证返回结果中不包含被设置为不可见的字段 | 1. 登录成功，返回管理员令牌<br>2. 角色创建成功<br>3. 字段权限设置成功<br>4. 用户创建成功<br>5. 查询接口调用成功<br>6. 返回结果中不包含被设置为不可见的字段 | | |

#### 4.2.2 测试场景：设置字段编辑权限
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P006 | 设置字段编辑权限 | 1. 登录系统，获取管理员令牌<br>2. 创建一个新角色<br>3. 调用 `/api/v1/field-permission` 接口为该角色设置某模块字段的编辑权限为不可编辑<br>4. 创建一个属于该角色的用户<br>5. 以该用户身份登录，调用相关模块的更新接口，尝试修改被设置为不可编辑的字段<br>6. 验证接口返回错误，提示没有权限修改该字段 | 1. 登录成功，返回管理员令牌<br>2. 角色创建成功<br>3. 字段权限设置成功<br>4. 用户创建成功<br>5. 更新接口调用失败<br>6. 返回错误信息，提示没有权限修改该字段 | | |

#### 4.2.3 测试场景：设置字段报表显示权限
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P007 | 设置字段报表显示权限 | 1. 登录系统，获取管理员令牌<br>2. 创建一个新角色<br>3. 调用 `/api/v1/field-permission` 接口为该角色设置某模块字段的报表显示权限为不可见<br>4. 创建一个属于该角色的用户<br>5. 以该用户身份登录，调用相关模块的报表接口<br>6. 验证返回的报表结果中不包含被设置为报表不可见的字段 | 1. 登录成功，返回管理员令牌<br>2. 角色创建成功<br>3. 字段权限设置成功<br>4. 用户创建成功<br>5. 报表接口调用成功<br>6. 返回的报表结果中不包含被设置为报表不可见的字段 | | |

### 4.3 数据字典功能

#### 4.3.1 测试场景：创建数据字典
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P008 | 创建数据字典 | 1. 登录系统，获取管理员令牌<br>2. 调用 `/api/v1/data-dictionary` 接口创建一个数据字典<br>3. 调用 `/api/v1/data-dictionary/:id` 接口验证数据字典创建成功 | 1. 登录成功，返回管理员令牌<br>2. 数据字典创建成功<br>3. 返回创建的数据字典信息，与输入一致 | | |

#### 4.3.2 测试场景：查询数据字典
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P009 | 查询数据字典 | 1. 登录系统，获取管理员令牌<br>2. 创建多个数据字典，属于不同模块和字段<br>3. 调用 `/api/v1/data-dictionary/module/:module` 接口查询特定模块的数据字典<br>4. 验证返回结果只包含该模块的数据字典<br>5. 调用 `/api/v1/data-dictionary/module/:module/field/:field` 接口查询特定模块和字段的数据字典<br>6. 验证返回结果只包含该模块和字段的数据字典 | 1. 登录成功，返回管理员令牌<br>2. 多个数据字典创建成功<br>3. 查询接口调用成功<br>4. 返回结果只包含该模块的数据字典<br>5. 查询接口调用成功<br>6. 返回结果只包含该模块和字段的数据字典 | | |

#### 4.3.3 测试场景：更新数据字典
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P010 | 更新数据字典 | 1. 登录系统，获取管理员令牌<br>2. 创建一个数据字典<br>3. 调用 `/api/v1/data-dictionary/:id` 接口获取数据字典详情<br>4. 调用 `/api/v1/data-dictionary/:id` 接口更新数据字典的某些字段<br>5. 再次调用查询接口，验证数据字典已更新 | 1. 登录成功，返回管理员令牌<br>2. 数据字典创建成功<br>3. 返回数据字典详情<br>4. 数据字典更新成功<br>5. 返回更新后的数据字典信息，与更新请求一致 | | |

#### 4.3.4 测试场景：删除数据字典
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P011 | 删除数据字典 | 1. 登录系统，获取管理员令牌<br>2. 创建一个数据字典<br>3. 调用 `/api/v1/data-dictionary/:id` 接口删除该数据字典<br>4. 调用 `/api/v1/data-dictionary/:id` 接口查询该数据字典<br>5. 验证返回结果显示该数据字典不存在 | 1. 登录成功，返回管理员令牌<br>2. 数据字典创建成功<br>3. 数据字典删除成功<br>4. 查询接口调用失败<br>5. 返回错误信息，提示该数据字典不存在 | | |

### 4.4 特殊权限优先级验证

#### 4.4.1 测试场景：特殊权限覆盖数据字典设置
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P012 | 特殊权限覆盖数据字典设置 | 1. 登录系统，获取管理员令牌<br>2. 创建一个数据字典，设置某字段为不可编辑<br>3. 创建一个角色<br>4. 调用 `/api/v1/field-permission` 接口为该角色设置该字段的特殊编辑权限为可编辑<br>5. 创建一个属于该角色的用户<br>6. 以该用户身份登录，调用相关模块的更新接口，尝试修改该字段<br>7. 验证接口调用成功，字段被成功修改 | 1. 登录成功，返回管理员令牌<br>2. 数据字典创建成功<br>3. 角色创建成功<br>4. 字段权限设置成功<br>5. 用户创建成功<br>6. 更新接口调用成功<br>7. 字段被成功修改，特殊权限优先级高于数据字典 | | |

#### 4.4.2 测试场景：没有特殊权限时遵循数据字典设置
| 测试用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
|------------|----------|----------|----------|----------|------|
| P013 | 没有特殊权限时遵循数据字典设置 | 1. 登录系统，获取管理员令牌<br>2. 创建一个数据字典，设置某字段为不可编辑<br>3. 创建一个角色<br>4. 调用 `/api/v1/field-permission` 接口为该角色设置该字段的特殊编辑权限为不可编辑<br>5. 创建一个属于该角色的用户<br>6. 以该用户身份登录，调用相关模块的更新接口，尝试修改该字段<br>7. 验证接口返回错误，提示没有权限修改该字段 | 1. 登录成功，返回管理员令牌<br>2. 数据字典创建成功<br>3. 角色创建成功<br>4. 字段权限设置成功<br>5. 用户创建成功<br>6. 更新接口调用失败<br>7. 返回错误信息，提示没有权限修改该字段，遵循数据字典设置 | | |

## 5. 测试执行记录
| 测试用例ID | 执行日期 | 执行人员 | 执行结果 | 问题描述 | 严重程度 |
|------------|----------|----------|----------|----------|----------|
| P001 | 2025-12-20 | cjx | 通过 | 为用户分配单个角色功能正常 | - |
| P002 | 2025-12-20 | cjx | 通过 | 为用户分配多个角色功能正常 | - |
| P003 | 2025-12-20 | cjx | 通过 | 修改用户已分配的角色功能正常 | - |
| P004 | 2025-12-20 | cjx | 通过 | 移除用户的所有角色功能正常 | - |
| P005 | 2025-12-20 | cjx | 通过 | 设置字段查看权限功能正常 | - |
| P006 | 2025-12-20 | cjx | 通过 | 设置字段编辑权限功能正常 | - |
| P007 | 2025-12-20 | cjx | 通过 | 设置字段报表显示权限功能正常 | - |
| P008 | 2025-12-20 | cjx | 通过 | 创建数据字典功能正常 | - |
| P009 | 2025-12-20 | cjx | 通过 | 查询数据字典功能正常 | - |
| P010 | 2025-12-20 | cjx | 通过 | 更新数据字典功能正常 | - |
| P011 | 2025-12-20 | cjx | 通过 | 删除数据字典功能正常 | - |
| P012 | 2025-12-20 | cjx | 待执行 | 特殊权限覆盖数据字典设置 | - |
| P013 | 2025-12-20 | cjx | 待执行 | 没有特殊权限时遵循数据字典设置 | - |

## 6. 测试结论
| 测试功能 | 测试结果 | 备注 |
|----------|----------|------|
| 单用户多角色分配功能 | 通过 | 所有测试用例均通过，功能正常 |
| 字段级权限控制 | 通过 | 所有测试用例均通过，功能正常 |
| 数据字典功能 | 通过 | 所有测试用例均通过，功能正常 |
| 特殊权限优先级验证 | 待执行 | |

## 7. 问题列表
| 问题ID | 问题描述 | 严重程度 | 复现步骤 | 解决方案 |
|--------|----------|----------|----------|----------|
| | | | | |
| | | | | |
| | | | | |

## 8. 建议
1. 
2. 
3. 
